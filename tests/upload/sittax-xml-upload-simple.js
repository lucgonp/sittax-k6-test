import http from 'k6/http';
import { check } from 'k6';

// Teste simples para upload XML Sittax
export const options = {
  vus: 1,           // Apenas 1 usuário virtual
  duration: '10s',  // Por 10 segundos
};

const xmlDocument = `<nfeProc xmlns="http://www.portalfiscal.inf.br/nfe" versao="4.00"><NFe xmlns="http://www.portalfiscal.inf.br/nfe"><infNFe Id="NFe52210105598429000146550010000015981788693369" versao="4.00"><ide><cUF>52</cUF><cNF>78869336</cNF><natOp>Compra</natOp><mod>55</mod><serie>1</serie><nNF>1598</nNF><dhEmi>2021-01-05T08:41:00-03:00</dhEmi><dhSaiEnt>2021-01-05T08:41:00-03:00</dhSaiEnt><tpNF>0</tpNF><idDest>1</idDest><cMunFG>5208707</cMunFG><tpImp>1</tpImp><tpEmis>1</tpEmis><cDV>9</cDV><tpAmb>1</tpAmb><finNFe>1</finNFe><indFinal>1</indFinal><indPres>0</indPres><procEmi>0</procEmi><verProc>0</verProc></ide><emit><CNPJ>05598429000146</CNPJ><xNome>GOIAPIRA COMERCIO DE VEICULOS EIRELI - ME</xNome><xFant>GOIAPIRA VEICULOS</xFant><enderEmit><xLgr>AV. Independencia</xLgr><nro>2913</nro><xCpl>QD. 64 LT. 17</xCpl><xBairro>Setor Leste Vila Nova</xBairro><cMun>5208707</cMun><xMun>Goiania</xMun><UF>GO</UF><CEP>74645010</CEP><cPais>1058</cPais><xPais>BRASIL</xPais><fone>6230917000</fone></enderEmit><IE>103604472</IE><IM>1957414</IM><CNAE>4511102</CNAE><CRT>3</CRT></emit><dest><CNPJ>11281914000194</CNPJ><xNome>SOMAR REPRESENTACAO E COMERCIO LTDA</xNome><enderDest><xLgr>AV. Circular</xLgr><nro>798</nro><xCpl>QD59 LT7 SL 01</xCpl><xBairro>Jardim Balneario Meia Ponte</xBairro><cMun>5208707</cMun><xMun>Goiania</xMun><UF>GO</UF><CEP>74590150</CEP><cPais>1058</cPais><xPais>BRASIL</xPais></enderDest><indIEDest>9</indIEDest><IE>104570032</IE></dest><det nItem="1"><prod><cProd>199</cProd><cEAN>SEM GTIN</cEAN><xProd>PEUGEOT 208 1.5ACTIVE FLEX ANO FAB 2013 MOD 2014 PLACA ONH2053 COR PRATA RENAVAM 544544765 CHASSI 936CLYFYYEB009764</xProd><NCM>87032210</NCM><CFOP>1102</CFOP><uCom>un</uCom><qCom>1.0000</qCom><vUnCom>20000.00000</vUnCom><vProd>20000.00</vProd><cEANTrib>SEM GTIN</cEANTrib><uTrib>un</uTrib><qTrib>1.0000</qTrib><vUnTrib>20000.00000</vUnTrib><indTot>1</indTot></prod><imposto><vTotTrib>6700.00</vTotTrib><ICMS><ICMS40><orig>0</orig><CST>40</CST></ICMS40></ICMS><PIS><PISNT><CST>07</CST></PISNT></PIS><COFINS><COFINSNT><CST>07</CST></COFINSNT></COFINS></imposto></det><total><ICMSTot><vBC>0.00</vBC><vICMS>0.00</vICMS><vICMSDeson>0.00</vICMSDeson><vFCP>0.00</vFCP><vBCST>0.00</vBCST><vST>0</vST><vFCPST>0.00</vFCPST><vFCPSTRet>0.00</vFCPSTRet><vProd>20000.00</vProd><vFrete>0.00</vFrete><vSeg>0.00</vSeg><vDesc>0.00</vDesc><vII>0.00</vII><vIPI>0.00</vIPI><vIPIDevol>0.00</vIPIDevol><vPIS>0.00</vPIS><vCOFINS>0.00</vCOFINS><vOutro>0.00</vOutro><vNF>20000.00</vNF><vTotTrib>6700.00</vTotTrib></ICMSTot></total><transp><modFrete>9</modFrete><vol><qVol>0</qVol><pesoL>0.000</pesoL><pesoB>0.000</pesoB></vol></transp><cobr><fat><nFat>1598</nFat><vOrig>20000.00</vOrig><vDesc>0.00</vDesc><vLiq>20000.00</vLiq></fat></cobr><pag><detPag><indPag>0</indPag><tPag>99</tPag><vPag>20000.00</vPag></detPag><vTroco>0.00</vTroco></pag><infAdic><infCpl>Voce pagou aproximadamente: |R$ 4.300,00 de tributos federais|R$ 2.400,00 de tributos estaduais|Fonte: IBPT/empresometro.com.br 5DC0AE|</infCpl></infAdic><infRespTec><CNPJ>64555626000147</CNPJ><xContato>Felipe Previde Marquez - ao3 NFe</xContato><email>sup.tecnico.dfe@ao3tech.com</email><fone>1930043303</fone></infRespTec></infNFe><Signature xmlns="http://www.w3.org/2000/09/xmldsig#"><SignedInfo><CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/><SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/><Reference URI="#NFe52210105598429000146550010000015981788693369"><Transforms><Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/><Transform Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/></Transforms><DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/><DigestValue>ZwdXCChNcRys5K3Jtf+Yza4TNQ4=</DigestValue></Reference></SignedInfo><SignatureValue>wRoAhR5RIA8xZP45fVYiyw3E5D/c0MQfnPbLbBmoS6Wmscq/JG2H2Bq5rcL+j6G32Bu68EQdmu/LsJlsRE5OUKrBYtoEmcJMwGhse1RR5fbYuNSnDFg+aZDFxLm6MH4dUrdNOLoXB65yX0Ib1hxAP8riFrZnwQ4oGMtaTzDXMhmS/SvU2X5H8ttV5UO+a/acy2EcSUjUYx7fqkyMAXEyU2Iw6nUjh9ZeUSQD7oL6UMzm75fzjiR41XJTZ55ZlTrmJNcBWhoCgM9W/ZU65ha2yEaUzNIg3vpbzQJq85h13Yexx2f+2h4be7AIL4YXCJnTR4wMTISk65FVkMWD7slOSw==</SignatureValue><KeyInfo><X509Data><X509Certificate>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</X509Certificate></X509Data></KeyInfo></Signature></NFe><protNFe versao="4.00"><infProt Id="ID152213718157813"><tpAmb>1</tpAmb><verAplic>0.0.1</verAplic><chNFe>52210105598429000146550010000015981788693369</chNFe><dhRecbto>2021-01-05T08:43:12-03:00</dhRecbto><nProt>152213718157813</nProt><digVal>ZwdXCChNcRys5K3Jtf+Yza4TNQ4=</digVal><cStat>100</cStat><xMotivo>Autorizado o uso da NF-e</xMotivo></infProt></protNFe></nfeProc>`;

export default function () {
  const payload = JSON.stringify({
    "Documento": xmlDocument
  });

  const response = http.post(
    'https://upload.sittax.com.br/api/xml/importar',
    payload,
    {
      headers: {
        'apikey': '7BC4817B-F8B4-4A6E-8C5E-F57B6B50713D',
        'Content-Type': 'application/json',
      }
    }
  );

  // Validação simples
  check(response, {
    'Status é 200': (r) => r.status === 200,
    'Resposta não vazia': (r) => r.body.length > 0,
  });

  console.log(`Status: ${response.status}, Tempo: ${response.timings.duration}ms`);
}